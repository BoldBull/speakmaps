<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Speak to Maps</title>
  <style>
    body{font-family:system-ui,Segoe UI,Arial;margin:0;display:grid;place-items:center;min-height:100svh;background:#111;color:#fff}
    .card{width:min(720px,92%);background:#1b1b1b;border-radius:18px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    button{font-size:18px;padding:14px 18px;border-radius:12px;border:0;cursor:pointer}
    .go{background:#4ade80} .stop{background:#f87171}
    .hint{opacity:.8;margin:.5rem 0 0}
    input{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #333;background:#0f0f0f;color:#fff;margin:12px 0}
  </style>
</head>
<body>
  <div class="card">
    <h1>Speak an address â†’ open in Maps</h1>
    <button id="btn" class="go">ğŸ¤ Start Listening</button>
    <p class="hint">Say: <em>â€œ123 Main Street, Elkhart Indianaâ€</em> or â€œnavigate to Walmart Goshenâ€.</p>
    <input id="text" placeholder="â€¦or type an address and press Enter" />
    <p id="status"></p>
  </div>

  <script>
    // Helpers
    const $ = id => document.getElementById(id);
    const status = msg => { $("status").textContent = msg || ""; };

    // Decide best URI for the device
    function mapsURLFromQuery(q) {
      const query = encodeURIComponent(q);
      const ua = navigator.userAgent.toLowerCase();
      const isIOS = /iphone|ipad|ipod/.test(ua);
      const isAndroid = /android/.test(ua);

      // Try native app first on mobile, fall back to web if it fails
      if (isAndroid) return `geo:0,0?q=${query}`;         // Android Maps app
      if (isIOS)     return `http://maps.apple.com/?q=${query}`; // iOS Apple Maps (fastest)
      // Desktop or unknown â†’ Google Maps web
      return `https://www.google.com/maps/search/?api=1&query=${query}`;
    }

    function openMaps(q) {
      if (!q) return status("Heard nothingâ€”try again.");
      status(`Opening: ${q}`);
      // Open in same tab to avoid popup blockers
      location.href = mapsURLFromQuery(q);
    }

    // Typed input support
    $("text").addEventListener("keydown", e => {
      if (e.key === "Enter") openMaps(e.target.value.trim());
    });

    // Speech recognition (Chrome/Edge/Android best)
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    let rec, listening = false;

    if (SR) {
      rec = new SR();
      rec.lang = "en-US";
      rec.interimResults = false;      // final text only
      rec.maxAlternatives = 1;

      rec.onresult = e => {
        const transcript = e.results?.[0]?.[0]?.transcript || "";
        openMaps(transcript.replace(/^navigate to/i, "").trim());
      };
      rec.onerror = e => status(`Mic error: ${e.error}`);
      rec.onend = () => { listening = false; btn.className = "go"; btn.textContent = "ğŸ¤ Start Listening"; };
    } else {
      status("Speech recognition not supported here. Type the address instead.");
    }

    const btn = $("btn");
    btn.onclick = () => {
      if (!rec) return status("Speech recognition not supported in this browser.");
      if (!listening) {
        listening = true;
        btn.className = "stop";
        btn.textContent = "ğŸ›‘ Stop";
        status("Listeningâ€¦");
        try { rec.start(); } catch {}
      } else {
        rec.stop();
      }
    };
  </script>
</body>
</html>
